var transit=function(){return{initMap:function(e,t,a){var n={mapTypeId:google.maps.MapTypeId.ROADMAP};$(e+"> #init").remove(),$(e).append('<div id="timezone"></div>').append('<div id="transitMap"></div>').append('<div id="toggleLog">Start Logging</div>'),$(e+"> #transitMap").css({position:"absolute",width:"100%",height:"100%"}),$(e+"> #timezone").css({position:"absolute",bottom:"3%",right:"0.8%","z-index":"99","font-weight":"bold"}),$(e+"> #toggleLog").css({position:"absolute",bottom:"4%",left:"1%","z-index":"99",color:"#800000","-webkit-box-shadow":"0px 0px 8px rgba(0, 0, 0, 0.3)","-moz-box-shadow":"0px 0px 8px rgba(0, 0, 0, 0.3)","box-shadow":"0px 0px 8px rgba(0, 0, 0, 0.3)","background-color":"hsl(0, 0%, 90%)","border-radius":"10px",padding:"10px","font-weight":"bold",cursor:"pointer"}),$(e+"> #toggleLog").click(function(){transit.initTicker(e);var t=e+"> #tickerDiv";$(t).css("display","inline"),$(t).fadeOut(5e3)}),transit.initStatus(e);var o=new google.maps.Map(document.getElementById("transitMap"),n);return transit.initSearch(e,t,a,o),o},initTicker:function(e){$(e).append('<div id="tickerDiv"><span style="color:#800000"><strong>Transit Log</span><br /><br /></strong><div id="ticker"></div><br /><div id="tickerCtrl"><span id="clear"><strong>Reset</strong></span> | <span id="stop"><strong>Stop logging</span></div></div>');var t=e+"> #tickerDiv",a=t+"> #ticker",n=t+"> #tickerCtrl",o=n+"> #clear",i=n+"> #stop";$(e+"> #toggleLog").css("display","none"),$(t).css({position:"absolute",bottom:"1%",left:"1%",width:"40%","z-index":"99","background-color":"hsl(0, 0%, 90%)",height:"38%","-webkit-box-shadow":"0px 0px 8px rgba(0, 0, 0, 0.3)","-moz-box-shadow":"0px 0px 8px rgba(0, 0, 0, 0.3)","box-shadow":"0px 0px 8px rgba(0, 0, 0, 0.3)","border-radius":"10px",padding:"10px","text-align":"center","overflow-y":"auto","overflow-x":"auto",display:"none"}),$(a).css({height:"75%","overflow-y":"auto","overflow-x":"auto","text-align":"left","line-height":"150%"}),$(n).css({cursor:"pointer",color:"#800000"}),$(o).click(function(){$(a).html("")}),$(i).click(function(){$(t).remove(),$(e+"> #toggleLog").css("display","inline")}),$(t).hover(function(){$(t).stop(!0,!0),$(t).css("display","inline")},function(){$(t).fadeOut(5e3)})},initStatus:function(e){$(e).append('<div id="status"></div>'),$(e+"> #status").css({position:"absolute",bottom:"3%",right:"0.8%","z-index":"99","background-color":"hsl(0, 0%, 90%)","-webkit-box-shadow":"0px 0px 8px rgba(0, 0, 0, 0.3)","-moz-box-shadow":"0px 0px 8px rgba(0, 0, 0, 0.3)","box-shadow":"0px 0px 8px rgba(0, 0, 0, 0.3)","border-radius":"5px",padding:"10px",display:"none"})},initSearch:function(e,t,a,n){$("head").append('<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />'),$.getScript("http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js",function(){$(e).append('<input type="text" id="search" placeholder="Search for a stop and select it from the dropdown.">');var o=e+"> #search";$(o).css({position:"absolute",width:"50%",height:"13px",top:"1%",left:"25%","z-index":"99","border-radius":"5px",padding:"5px"}),$(o).autocomplete({source:t,select:function(e,t){var o=a[t.item.value],i=new google.maps.LatLng(o.x,o.y);n.setZoom(15),n.setCenter(i)}}),$(".ui-autocomplete").css({"max-height":"50%","overflow-y":"auto","overflow-x":"hidden","padding-right":"20px"})})},initMarker:function(e,t,a,n){var o=new google.maps.LatLng(e.x,e.y),i={path:google.maps.SymbolPath.CIRCLE,fillColor:n,fillOpacity:.8,scale:7},s={position:o,icon:i};return s=new google.maps.Marker(s)},onMarkerMouseover:function(e,t,a,n){google.maps.event.clearListeners(a,"mouseover"),google.maps.event.clearListeners(a,"mouseout"),transit.isMobileDevice()?n='<div style="font-size:20px;">'+n+"</div>":(google.maps.event.addListener(a,"mouseover",function(){$(e+"> #status").stop(!0,!0),$(e+"> #status").css("display","inline"),$(e+"> #status").html(n)}),google.maps.event.addListener(a,"mouseout",function(){$(e+"> #status").css("display","none")})),"undefined"!=typeof a.infoWindow?a.infoWindow.setContent(n):(a.infoWindow=new google.maps.InfoWindow({content:n}),google.maps.event.addListener(a,"click",function(){a.infoWindow.open(t,a)}),google.maps.event.addListener(t,"click",function(){a.infoWindow.close()}))},overlayKml:function(e,t){var a={map:t};new google.maps.KmlLayer(e,a)},kmlPromise:function(e){return $.ajax({url:e,dataType:"xml",async:!0})},jsonPromise:function(e){return $.ajax({url:e,dataType:"json",async:!0})},routeParser:function(e){var t={},a={},n=new Array,o=$("Document",e);return o.find("Placemark > LineString > coordinates").each(function(){var e=transit.trim($(this).text()).split(" "),a=new Array,n=$(this).closest("Placemark").find("name").text().toLowerCase();for(eachPt in e){var o=transit.strip(e[eachPt]).split(",");a.push({x:parseFloat(o[1],10),y:parseFloat(o[0],10)})}t[transit.trim(n)]=a}),o.find("Point").each(function(){var e=$(this).closest("Placemark"),t=transit.strip(e.find("Point").text()).split(","),o=transit.trim(e.find("name").text()).toLowerCase();n.push(o),a[o]={x:parseFloat(t[1],10),y:parseFloat(t[0],10)}}),{lines:t,points:a,stopnames:n}},vehicleParser:function(e){var t={};return t.timezone=e.timezone,t.vehicles=e.vehicles,t.stopinterval=e.defaultstopinterval,t},scheduler:function(e,t,a){var n={},o={},i=new Array,s=new Array,r=e.stops,d=e.stops.length,l=r[0],c=l.name;if("undefined"==typeof l.departure)throw new Error(e.name+" is missing its initial departure time at "+c);var u=transit.parseTime(l.departure.time,l.departure.day),f={},h=t.points,m=t.lines[e.route.toLowerCase()];if("undefined"==typeof m)throw new Error(e.name+"'s route "+e.route+" doesn't exist.");s.push(l.departure.time),o[u-u]=c,i.push(u-u);try{f[c]=transit.resolvePointToLine(m,h[c.toLowerCase()])}catch(p){throw new Error("The stop "+c+" in vehicle "+e.name+"'s schedule wasn't found in its route.")}for(var g=1;d-1>g;g++){var v=r[g];r[g-1];var y=v.name;if("undefined"==typeof v.arrival){var I=transit.parseTime(v.departure.time,v.departure.day)-u,b=I-transit.parseTime(a,1);v.arrival={},v.arrival.time=transit.secondsToHours(b+u).replace("+",""),v.arrival.day=Math.ceil((b+u)/86400)}else var b=transit.parseTime(v.arrival.time,v.arrival.day)-u;if("undefined"==typeof v.departure){var b=transit.parseTime(v.arrival.time,v.arrival.day)-u,I=b+transit.parseTime(a,1);v.departure={},v.departure.time=transit.secondsToHours(I+u).replace("+",""),v.departure.day=Math.ceil((I+u)/86400)}else var I=transit.parseTime(v.departure.time,v.departure.day)-u;s.push(v.arrival.time,v.departure.time),n[b]=y,o[I]=y,i.push(b,I);try{f[y]=transit.resolvePointToLine(m,h[y.toLowerCase()])}catch(p){throw new Error("The stop "+y+" in vehicle "+e.name+"'s schedule wasn't found in its route.")}}var w=r[d-1],A=w.name;if("undefined"==typeof w.arrival)throw new Error(e.name+" is missing its final arrival time at "+A);var k=transit.parseTime(w.arrival.time,w.arrival.day)-u;if(n[k]=A,s.push(w.arrival.time),i.push(k),!transit.isSorted(i))throw new Error(e.name+" seems to be going backwards in time.");try{f[A]=transit.resolvePointToLine(m,h[A.toLowerCase()])}catch(p){throw new Error("The stop "+A+" in vehicle "+e.name+"'s schedule wasn't found in its route.")}var C=["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenRod","DarkGray","DarkGrey","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","Darkorange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkSlateGrey","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DimGrey","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","GoldenRod","Gray","Grey","Green","GreenYellow","HoneyDew","HotPink","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenRodYellow","LightGray","LightGrey","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","Maroon","MediumAquaMarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenRod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","Red","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"];return e.color=C[Math.floor(Math.random()*C.length)],{name:e.name,info:e.info,color:e.color,starts:u,baseinfo:transit.createBaseInfo(e.name,e.info,c,l.departure.time,A,w.arrival.time),route:m,stops:f,days:w.arrival.day-l.departure.day,arrivals:n,departures:o,traveltimes:i,traveltimesasstrings:s}},strip:function(e){return e.replace(/\s+/g,"").replace(/\n/g,"")},trim:function(e){return e.replace(/^\s+|\s+$/g,"")},isSorted:function(e){for(var t=0;t<e.length-1;t++)if(e[t]>e[t+1])return!1;return!0},resolvePointToLine:function(e,t){if(t.x==e[0].x&&t.y==e[0].y)return t;for(var a=transit.linearDist(e[0],t).toFixed(20),n=e[0],o=1;o<e.length;o++){if(t.x==e[o].x&&t.y==e[o].y)return t;var i=transit.linearDist(e[o],t).toFixed(20);a>i&&(n=e[o],a=i)}return n},haversine:function(e,t){var a=6371;"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180});var n=(t.x-e.x).toRad(),o=(t.y-e.y).toRad(),i=e.x.toRad(),s=t.x.toRad(),r=Math.sin(n/2)*Math.sin(n/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(i)*Math.cos(s),d=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),l=a*d;return l},linearDist:function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},percentDist:function(e,t,a){var n={},o=a/100;return n.x=(1-o)*e.x+o*t.x,n.y=(1-o)*e.y+o*t.y,n},percentInRange:function(e,t,a){return 100*((a-e)/(t-e))},pointsBetweenStops:function(e,t,a){var n=transit.indexOfCoordsObjInList(e,t),o=transit.indexOfCoordsObjInList(e,a);return n>o?e.slice(o,n+1).reverse():e.slice(n,o+1)},indexOfCoordsObjInList:function(e,t){for(var a=0;a<e.length;a++)if(t.x==e[a].x&&t.y==e[a].y)return a;return-1},hashOfPercentDists:function(e){e[0];var t=e.length;e[t-1];for(var a={0:e[0]},n=[0],o=0,i=new Array,s=0;t-1>s;s++)o+=transit.linearDist(e[s],e[s+1]),n.push(o);for(var s=0;s<n.length;s++){var r=transit.percentInRange(0,o,n[s]);i.push(r),a[r]=e[s]}return{percentages:i,hash:a}},enclosure:function(e){for(var t,a,n=0,o=this.length-1;o>=n;)if(t=0|(n+o)/2,a=this[t],e>a)n=t+1;else{if(!(a>e))return t;o=t-1}return e>this[t]?"undefined"!=typeof this[t+1]?[t,t+1]:-1:"undefined"!=typeof this[t-1]?[t-1,t]:-1},parseTimeZone:function(e){var t=(new Date).getTimezoneOffset(),a=e.split(":");return a=a.map(function(e){return parseInt(e,10)}),a.length<3&&(a[2]=0),a[0]<0&&(a[1]*=-1,a[2]*=-1),3600*a[0]+60*a[1]+a[2]+60*t},dayInTimezone:function(e){var t=Math.ceil((transit.parseTime(transit.currTime(),1)+transit.parseTimeZone(e))/86400)-1,a=(new Date).getDay(),n=a+t,o=0>n?6+n%7:n%7;return o},parseTime:function(e,t){var a=/^(?:2[0-3]|[01]?[0-9]):[0-5]?[0-9](:[0-5]?[0-9])?$/;if(!a.test(e))throw new Error(e+" is not a valid timestring.");var n=e.split(":");return n=n.map(function(e){return parseInt(e,10)}),n.length<3&&(n[2]=0),3600*n[0]+60*n[1]+n[2]+86400*(t-1)},currTime:function(){var e=new Date;return e.getHours().toString()+":"+e.getMinutes().toString()+":"+e.getSeconds().toString()},secondsToHours:function(e){var t=Math.abs(e),a=parseInt(t/3600)%24,n=parseInt(t/60)%60,o=t%60,i=(10>a?"0"+a:a)+":"+(10>n?"0"+n:n)+":"+(10>o?"0"+o:o);return e>=0?"+"+i:"-"+i},estimateCurrentPosition:function(e,t){var a=e.arrivals,n=e.departures,o=e.traveltimes,i=e.traveltimesasstrings,s=e.days,r=e.starts,d=e.route,l=e.stops,c=new Array;60*(new Date).getTimezoneOffset();for(var u=transit.currTime(),f=1;s+1>=f;f++){var h=transit.enclosure.call(o,transit.parseTime(u,f)+transit.parseTimeZone(t)%86400-r),m={stationaryAt:"",departureTime:0,leaving:"",approaching:"",leftTime:0,approachTime:0,started:!1,completed:!1,justReached:!1,justLeft:!1,currentCoords:null};if(0==h[0]%2&&2==h.length){var p=o[h[0]],g=o[h[1]];m.leftTime=i[h[0]],m.approachTime=i[h[1]];var v=n[p],y=a[g];m.leaving=v,m.approaching=y;var I=l[v],b=l[y],w=transit.percentInRange(o[h[0]],o[h[1]],transit.parseTime(u,f)+transit.parseTimeZone(t)%86400-r),A=transit.pointsBetweenStops(d,I,b),k=transit.hashOfPercentDists(A),C=k.hash,x=k.percentages,P=transit.enclosure.call(x,w),T=x[P[0]],_=x[P[1]],D=transit.percentInRange(T,_,w);m.currentCoords=transit.percentDist(C[T],C[_],D)}else 0!=h[0]%2&&2==h.length?(m.stationaryAt=n[o[h[1]]],m.departureTime=i[h[1]],m.currentCoords=l[m.stationaryAt]):h>0&&h<o.length-1?0!=h%2?(m.justReached=!0,m.stationaryAt=n[o[h+1]],m.departureTime=i[h+1],m.currentCoords=l[m.stationaryAt]):(m.justLeft=!0,m.stationaryAt=n[o[h]],m.approachingStop=a[o[h+1]],m.departureTime=i[h],m.approachTime=i[h+1],m.currentCoords=l[m.stationaryAt]):h==o.length-1?(m.completed=!0,m.stationaryAt=a[o[h]],m.currentCoords=l[m.stationaryAt]):0==h&&(m.started=!0,m.stationaryAt=n[o[h]],m.approachingStop=a[o[h+1]],m.approachTime=i[h+1],m.currentCoords=l[m.stationaryAt]);c.push(m)}return c},createBaseInfo:function(e,t,a,n,o,i){return"<strong>Vehicle: </strong>"+e+"<br />"+("undefined"!=typeof t?"<strong>Info: </strong>"+t+"<br />":"")+"<strong>Start: </strong>"+a+" ("+n+")<br />"+"<strong>End: </strong>"+o+" ("+i+")<br />"},createPositionInfo:function(e,t){return t.stationaryAt?e+"<strong>At: </strong>"+t.stationaryAt+"<br />"+"<strong>Departure: </strong>"+t.departureTime:e+"<strong>Left: </strong>"+t.leaving+" ("+t.leftTime+")"+"<br />"+"<strong>Approaching: </strong>"+t.approaching+" ("+t.approachTime+")"},writeLog:function(e,t,a){var n=e+"> #tickerDiv",o=n+"> #ticker";if($(n).length>0&&(t.justReached||t.justLeft||t.started||t.completed)){if($(n).show(),$(n).stop(!0,!0),t.justReached)$(o).append("<em>"+transit.currTime()+"</em> | "+"<strong>"+a.name+"</strong> just reached <strong>"+t.stationaryAt+"</strong>. "+"Departs at: <strong>"+t.departureTime+"</strong>.<br />");else if(t.justLeft||t.started){var i=t.started?"just started from":"just left";$(o).append("<em>"+transit.currTime()+"</em> | "+"<strong>"+a.name+"</strong> "+i+" <strong>"+t.stationaryAt+"</strong>. "+"Next Stop: <strong>"+t.approachingStop+"</strong> at <strong>"+t.approachTime+"</strong>.<br />")}else t.completed&&$(o).append("<em>"+transit.currTime()+"</em> | "+"<strong>"+a.name+"</strong> just reached its destination at <strong>"+t.stationaryAt+"</strong>.<br />");$(n).css("display","inline"),$(o).scrollTop($(o)[0].scrollHeight),$(n).fadeOut(5e3)}},writeStatus:function(e,t){$(e+"> #status").css("display","inline"),$(e+"> #status").html(t)},isMobileDevice:function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|ipad|playbook|silk|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))?!0:!1},setInMotion:function(e,t,a,n,o,i,s){setInterval(function(){for(var t=0;n>t;t++){var o=a[t];"undefined"==typeof o.markers&&(o.markers=new Array);for(var r=transit.estimateCurrentPosition(o,i),d=0;d<r.length;d++){var l=r[d];if(l.currentCoords){transit.writeLog(e,l,o),l.completed&&(o.markers[d].setMap(null),delete o.markers[d]);var c=transit.createPositionInfo(o.baseinfo,l);if("undefined"==typeof o.markers[d]){var u=transit.initMarker(l.currentCoords,e,s,o.color);u.setMap(s),o.markers[d]=u}else{var f=new google.maps.LatLng(l.currentCoords.x,l.currentCoords.y);o.markers[d].setPosition(f)}transit.onMarkerMouseover(e,s,o.markers[d],c)}else"undefined"!=typeof o.markers[d]&&(o.markers[d].setMap(null),delete o.markers[d])}}},t)},callMain:function(e,t,a,n,o,i){var s=n.timezone,r=n.stopinterval,d=transit.initMap(e,a.stopnames,a.points);if(transit.overlayKml(o,d),$("#timezone").append("UTC"+s+"/Local"+transit.secondsToHours(transit.parseTimeZone(s)%86400)),"undefined"==typeof i)for(var i=n.vehicles,l=i.length,c=0;l>c;c++)try{i[c]=transit.scheduler(i[c],a,r)}catch(u){throw transit.writeStatus(e,u),new Error(u)}else var l=i.length;transit.setInMotion(e,t,i,l,r,s,d)},initialize:function(e,t,a,n,o){o="undefined"==typeof o||1>o?1e3:1e3*o,$(e).css({position:"relative","font-family":'"Lucida Grande", "Lucida Sans Unicode",Verdana, Arial, Helvetica, sans-serif',"font-size":"12px","text-shadow":"hsla(0,0%,40%,0.5) 0 -1px 0, hsla(0,0%,100%,.6) 0 2px 1px","background-color":"hsl(0, 0%, 90%)"}),$(e).append("<div id='init' style='position:absolute;width:100%;text-align:center;font-size:20px;top:48%;'><strong>Initialis(z)ing...</strong></div>"),google.maps.event.addDomListener(window,"load",function(){var i=transit.kmlPromise(t),s=transit.jsonPromise(n);i.success(function(t){s.success(function(n){var i=transit.routeParser(t),s=transit.vehicleParser(n);transit.callMain(e,o,i,s,a)}).fail(function(){$(e).css("position","relative"),$(e).html(""),transit.initStatus(e),transit.writeStatus(e,"Oh Shoot, there was an error loading the JSON file.")})}).fail(function(){$(e).css("position","relative"),$(e).html(""),transit.initStatus(e),transit.writeStatus(e,"Oh Shoot, there was an error loading the KML file.")})})}}}();